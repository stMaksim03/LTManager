<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LTmanager</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="creating-task.css">
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Шапка сайта -->
    <header>
        <nav>
            <div class="logo">
                <a href="index.html"><img src="scr/logo.svg" alt="Логотип"></a>
            </div>
            <ul class="nav-menu">
                <li><a href="entrance.html">Войти</a></li>
                <li><a href="creating-task-method.html">Создать задачу</a></li>
                <li><a href="#">О сервисе</a></li>
            </ul>
            <div class="menu-toggle" onclick="toggleMenu()">☰</div>
        </nav>
    </header>

    <!-- Основное содержимое -->
    <main>
        <h1>Создание задачи</h1>

            <div class="types">
                <div class="container">
                    <h2>Типы грузов</h2>
                    <div id="container-cargo-type">
                      <div class="form" class="form-cargo-type" id="form-cargo-type-0">
                          <input type="text" placeholder="Наименование груза" class="cargo-name-input">
                          <input type="text" placeholder="Вес/ед">
                          <button class="bin remove-form-cargo-type"></button>
                      </div>
                    </div>
                    <button class="add-form-button" class="add-form-cargo-type" id="add-form-cargo-type">Добавить еще</button>
                </div>
                
                <div class="container">
                    <h2>Типы машин</h2>
                    <div id="form-truck-type">
                      <div class="form" class="form-truck-type" id="form-truck-type-0">
                          <input type="text" placeholder="Наименование">
                          <input type="text" placeholder="Грузоподъемность/т">
                          <button class="bin remove-form-truck-type"></button>
                      </div>
                    </div>
                    <button class="add-form-button" class="add-form-truck-type" id="add-form-truck-type">Добавить еще</button>
                </div>
            </div>

            <div class="container">
                <h2>Склады/отправка</h2>
                <div id="container-warehouse">
                  <div class="warehouse-form" id="warehouse-form-0">
                      <div class="form form-place">
                          <input type="text" placeholder="Название">
                          <input type="text" placeholder="Адрес">
                      </div>
                      <div class="cargo-list">
                        <div class="cargo-item">
                            <div class="cargo-item-specification">
                                <input type="text" placeholder="Тип груза" class="cargo-type-input" list="cargo-types-list">
                                <datalist id="cargo-types-list"></datalist>
                                <input type="text" placeholder="Количество">
                            </div>
                            <div class="cargo-item-buttons">
                              <button class="add-cargo">Добавить груз</button>
                              <button class="remove-cargo">Удалить груз</button>
                          </div>
                        </div>
                      </div>
                      <button class="remove-warehouse">Удалить склад</button>
                  </div>
                </div>
                <button class="add-form-button" id="add-warehouse">Добавить еще</button>
            </div>
            
            <div class="container">
                <h2>Пункты приема</h2>
                <div id="container-destination">
                  <div class="destination-form" id="destination-form-0">
                      <div class="form form-place">
                          <input type="text" placeholder="Название">
                          <input type="text" placeholder="Адрес">
                      </div>
                      <div class="cargo-list">
                        <div class="cargo-item">
                            <div class="cargo-item-specification">
                                <input type="text" placeholder="Тип груза" class="cargo-type-input" list="cargo-types-list">
                                <datalist id="cargo-types-list"></datalist>
                                <input type="text" placeholder="Количество">
                            </div>
                            <div class="cargo-item-buttons">
                              <button class="add-cargo">Добавить груз</button>
                              <button class="remove-cargo">Удалить груз</button>
                          </div>
                        </div>
                      </div>
                      <button class="remove-destination">Удалить пункт</button>
                  </div>
                </div>
                <button class="add-form-button" id="add-destination">Добавить еще</button>
            </div>
    </main>

    <!-- Подвал сайта -->
    <footer>
        <p>&copy; 2025 Все права защищены.</p>
    </footer>

    <script>
        function toggleMenu() {
            document.querySelector(".nav-menu").classList.toggle("active");
        }

        function updateCargoTypesList() {
            const cargoNameInputs = document.querySelectorAll('.cargo-name-input');
            const cargoTypesList = document.getElementById('cargo-types-list');
            
            cargoTypesList.innerHTML = '';
            
            const cargoTypes = new Set();
            cargoNameInputs.forEach(input => {
                if (input.value.trim() !== '') {
                    cargoTypes.add(input.value.trim());
                }
            });
            
            cargoTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                cargoTypesList.appendChild(option);
            });
        }

        function createLittleDynamicForm(containerId, formClass, addButtonId, fillingLable) {
            const container = document.getElementById(containerId);
            const addButton = document.getElementById(addButtonId);
            let formCount = 1;

            addButton.addEventListener('click', () => {
                const newForm = document.createElement('div');
                newForm.classList.add('form', formClass);
                newForm.id = `${formClass}-${formCount}`;
                
                const isCargoType = formClass === 'form-cargo-type';
                const nameInputClass = isCargoType ? 'cargo-name-input' : '';
                
                newForm.innerHTML = `
                    <input type="text" placeholder="Наименование" class="${nameInputClass}">
                    <input type="text" placeholder="${fillingLable}">
                    <button class="bin remove-${formClass}"></button>
                `;
                container.appendChild(newForm);

                // обработчики для новых создаваемых форм
                const removeButton = newForm.querySelector(`.remove-${formClass}`);
                removeButton.addEventListener('click', () => {
                    container.removeChild(newForm);
                    if (isCargoType) {
                        updateCargoTypesList(); // обновление списка при удалении
                    }
                });

                if (isCargoType) {
                    const nameInput = newForm.querySelector('.cargo-name-input');
                    nameInput.addEventListener('input', updateCargoTypesList); // обработчик изменения полей наименования груза
                }

                formCount++;
            });

            // обработчики для начальных форм
            container.addEventListener('click', (event) => {
                if (event.target.classList.contains(`remove-${formClass}`)) {
                    const formBlock = event.target.parentNode;
                    container.removeChild(formBlock);
                    if (formClass === 'form-cargo-type') {
                        updateCargoTypesList(); // обновление списка при удалении
                    }
                }
            });

            if (formClass === 'form-cargo-type') {
                const existingInputs = container.querySelectorAll('.cargo-name-input');
                existingInputs.forEach(input => {
                    input.addEventListener('input', updateCargoTypesList); // обработчик изменения полей наименования груза
                });
            }
        }

        function createBigDynamicForm(containerId, addButtonId, type) {
            const container = document.getElementById(containerId);
            const addButton = document.getElementById(addButtonId);
            let formCount = 1;

            addButton.addEventListener('click', () => {
                const newForm = document.createElement('div');
                newForm.classList.add(`${type}-form`);
                newForm.id = `${type}-form-${formCount}`;
                newForm.innerHTML = `
                    <div class="form form-place">
                        <input type="text" placeholder="Название">
                        <input type="text" placeholder="Адрес">
                    </div>
                    <div class="cargo-list">
                        <div class="cargo-item">
                            <div class="cargo-item-specification">
                                <input type="text" placeholder="Тип груза" class="cargo-type-input" list="cargo-types-list">
                                <datalist id="cargo-types-list"></datalist>
                                <input type="text" placeholder="Количество">
                            </div>
                            <div class="cargo-item-buttons">
                                <button class="add-cargo">Добавить груз</button>
                                <button class="remove-cargo">Удалить груз</button>
                            </div>
                        </div>
                    </div>
                    <button class="remove-${type}">Удалить ${type === 'warehouse' ? 'склад' : 'пункт'}</button>
                `;
                container.appendChild(newForm);

                const addCargoButtons = newForm.querySelectorAll('.add-cargo');
                const removeCargoButtons = newForm.querySelectorAll('.remove-cargo');

                addCargoButtons.forEach(btn => {
                    btn.addEventListener('click', addCargoItem);
                });

                removeCargoButtons.forEach(btn => {
                    btn.addEventListener('click', removeCargoItem);
                });

                formCount++;
            });

            container.addEventListener('click', (event) => {
                if (event.target.classList.contains(`remove-${type}`)) {
                    const formBlock = event.target.parentNode;
                    container.removeChild(formBlock);
                }
            });

            const addCargoButtons = container.querySelectorAll('.add-cargo');
            const removeCargoButtons = container.querySelectorAll('.remove-cargo');

            addCargoButtons.forEach(btn => {
                btn.addEventListener('click', addCargoItem);
            });

            removeCargoButtons.forEach(btn => {
                btn.addEventListener('click', removeCargoItem);
            });

            function addCargoItem(e) {
                const cargoList = e.target.closest('.cargo-list');
                const newCargoItem = document.createElement('div');
                newCargoItem.classList.add('cargo-item');
                newCargoItem.innerHTML = `
                    <div class="cargo-item-specification">
                        <input type="text" placeholder="Тип груза" class="cargo-type-input" list="cargo-types-list">
                        <datalist id="cargo-types-list"></datalist>
                        <input type="text" placeholder="Количество">
                    </div>
                    <div class="cargo-item-buttons">
                        <button class="add-cargo">Добавить груз</button>
                        <button class="remove-cargo">Удалить груз</button>
                    </div>
                `;
                cargoList.appendChild(newCargoItem);

                newCargoItem.querySelector('.add-cargo').addEventListener('click', addCargoItem);
                newCargoItem.querySelector('.remove-cargo').addEventListener('click', removeCargoItem);
            }

            function removeCargoItem(e) {
                const cargoItem = e.target.closest('.cargo-item');
                if (cargoItem && cargoItem.parentElement.querySelectorAll('.cargo-item').length > 1) {
                    cargoItem.parentElement.removeChild(cargoItem);
                }
            }
        }

        createLittleDynamicForm('container-cargo-type', 'form-cargo-type', 'add-form-cargo-type', 'Вес/ед');
        createLittleDynamicForm('form-truck-type', 'form-truck-type', 'add-form-truck-type', 'Грузоподъемность/т');
        createBigDynamicForm('container-warehouse', 'add-warehouse', 'warehouse');
        createBigDynamicForm('container-destination', 'add-destination', 'destination');

        updateCargoTypesList();
    </script>
</body>
</html>